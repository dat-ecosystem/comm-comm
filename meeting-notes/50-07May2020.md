# dat protocol Community communication

07 May 2020

## People

* Diego (@dpaez)
* Mauve
* @lidel
* dietrich
* jan (@falafeljan)
* nina
* Paul
* [bret](https://bret.io)
* [Franz](https://github.com/Frando)
* substack
* Davie

## Meeting Notes

### Intro

- Diego: Works at GEUT. Working on integrating hyperdrive-daemon with p2p-commons SDK.
- Paul: Works on Beaker Browser. Got the Beaker Beta to be released in about a week. Wrapping up the final pieces.
- Sam: Working at Cliqz, browser company that's shutting down. There will still be a core left over so could maybe continue on the Dat stuff, the dat protocol in firefox based browsers. Latest is getting Dat v2 working there. Got the new hyperswarm and hyperdrive version working there. Will be compatible with Beaker when that's out.
- Nina: Working at playproject.io Working on DatDot, a p2p hosting solution, everyone that has empty space will be able to offer it, in exchange they'll get hosting when they're offline. Currently working on MVP, working with Mauve. Exciting, getting there and it's a lot of work.
- mauve: working on datdot with nina. also working on natakanu, file transfer app for indigenous communities in canada sponsored by Wapikoni Mobile. Also working with ipfs on an ipfs-companion, fixing mdns discovery in brave browser. Need to touch some c++ for Chromium patch. Dat uses the same MDNS stuff so it could be useful if we ever make an extension.
- Frando. Working mostly on [Sonar](https://github.com/arso-project/sonar/), a p2p database and search engine. Based on the dat stack: Hypercore and kappa-core. Also involved in new version of kappa-core, there's a [PR open on github](https://github.com/kappa-db/kappa-core/pull/14). Kappa-core is used by a few projects like Mapeo, Cabal, and Peermaps. Moving stuff forward and trying to get closer. Sonar is a search engine and DB based on kappa-core. Idea is to create archival apps that ingest stuff like files or RSS feeds and create searchable archives of that content.
- Lidel: Working on IPFS in web browsers. Working with Mauve on local discovery in Brave, also have separate work with Igalia on adding generic protocol handlers for browser extensions. Might end up extending the existing registerProtocolHandler. One of the reasons I'm here with Dietrich, we want to align Chromium and Firefox. Browsers can register protocol handlers, we want to be able to return bytes for our protocols. By our we also mean Dat and SSB in addition to IPFS. More later but that's the work I'm involved with.
- Dietrich: Lidel gave a good description. Been here a couple of times. Worked on Firefox for a long time, working on IPFS now on a bunch of web stuff. Want to lift the web platform for non-http protocols.
- Ed: Work in the GLAM sector (galleries, libraries, museums). Working on universal viewer, using IIIF spec. Working on experimenting making that work on Dat and IPFS. Would be excited to see it take off in the GLAM sector.
- Jan: Work this year inspired by Ed, wrote my master's thesis, submitted recently, about a system called [Hyperwell](https://github.com/hyperwell) that builds upon Dat and hypermerge for creating local first apps. Allows you to work with the data without being connected to the internet but if you are connected you can collaborate with CRDTs. In theory you could do a google docs that doesn't use Google. Would be glad to show ideas, also related to protocol support. Working around it with websockets. Would be nice to get Dat and IPFS in browsers so we can have real DApps.
- Kevin: @zootella on GH and twitter. Working at littlestar with Joe Werle and Bret, working on getting p2p to work on a streaming stack. Going all the way to the bottom. Mostly brought here with ara.one an electron app for creators and users, take a podcast and distribute bandwidth free without worrying about being deplatformed. Been playing with static generators, want to work in different places, Beaker, Zeronet, and when you click index.html. Most are just for servers or just for Beaker. Passionate about telemetry and how it goes through a swarm. Trying to put this into Ara and Little star so we can compare stack to stack and year to year how well this stuff is working.
- substack: I work on Peermaps and Cabal, implementing moderation stuff. Porting peermaps database to use rust async for random access support. Almost got the database working with random access web module but the database isn't async yet.
- Serapath: Whatever Nina said
- Davie: Just listening. I am interested in how Dat can run in a Progressive Web App. Mauve said that the dat-sdk can run in the browser.
- Bret: As kevin mentioned, work at little star. Also hello to the familiar faces. Haven't been doing much p2p lately, been maintaining a hyperswarm DHT node on redundant AWS infrastructure. Part of a project at work, we use hypercore for custom distribution platform for clients. Will paste the gist that people have been coordinating on if people want to run their own node. [Join the DHT](https://gist.github.com/mafintosh/ec498f6f1ec32bfb74b777137b6f7d55)


## First topic: Hyperwall a p2p system for annotation using hypermerge and hyperswarm

- Jan: There's annotation support on the web, sometimes it's there sometimes it isn't. Xanadu was one of the pioneering hypertext systems. Some of Ted Nelson's were far-stretching but quite profound. Interrelations between documents are much more structured and is more of a system than an ecosystem. In academia, I was focused on digital humanities, they do lots of annotations. There's a web annotation standard. Wanted to build a system that let you interact with local first apps with a browser app. Lots of academics have browser apps. You can annotate on the web with "hypothesis", not a real system??, you always have centralized storage for annotation. Dropbox, or Google Docs annotations. You have no reference to canonical content that's maybe not just a URL but maybe an ISN, maybe like a dat or bittorrent link or IPFS for content addressability. Read this paper about local first software last year. It was nice, like git. While git uses centralized repos, you always have the stuff on your computer locally. Using local first apps you can have the data locally, and using some sort of structure you can automatically merge stuff. You can usually do that with a rich text editor, but you can't easily merge an audio project or photoshop. Theory is that with annotation you can. You have annotation workbooks, communicate with hyperswarm. Replicate repo that contains JSON. Can annotate a PDF, annotations will be exchanged in real time. If we had the protocol support in the web it would be straightforward. How to do it with today's technology. People are using WebRTC, had trouble getting it. Couldn't use it with Firefox. Used websockets. Could try to join hyperswarm with proxies or relays, but the new hypercore doesn't use in the browser. Hypermerge uses new hypercore. Approach was to use a gateway server. Acts as a node. E.g.: if I was collaborating with Frando and Diego wanted to join with a web app and they didn't have the local first app themselves, I used a gateway that acts as a peer on the network and clones the repository. Gets a bunch of hypermerge changes and gives an HTTP API, sound like going back, thing is that a lot of academia uses linked data, e.g. SOLID. Lots of projects using linked open data and linked data projects. They use HTTP stuff. What my implementation does, if it can use it in browsers, it could use Sonar or Peermaps and could integrate directly into browsers. Still "legacy" tech that will be around for some time. Gateway stuff is interesting because it allows apps to be decentralized, compatible with tech we have today. Next steps is using a local first app, like the Mac OS note taking app to collect your notes, makes your notes searchable and indexed. Wanted to have a note app with own storage provider. Wanted annotation with stuff like PDFs. If you're interested in this, I would be glad to discuss this.
- github.com/hyperwell
- Sam: Sounds cool, is it like Hypothesis?
- Jan: yeah, you can annotate text and images. It's based on a [W3C standard](https://www.w3.org/TR/annotation-model).
- Sam: Saw the attempt but never saw it as a browser feature. Hypothesis is well connected with academia. Some US ivy league. They don't let you choose your storage. They don't have private collaboration. If there's a paper I can't share with everybody, I'd like to be able to encrypt and share the notebook. Hypercore somewhat provides this
- Sam: Been hacking on something related ([example](https://pad.dat-web.eu/#f8da4217eb46fa424593b02f8c655d2bfc5da527f9a4eb645aa91a6a8b9de5fa)). Putting a CRDT to have multiwriter over hypercore. Gonna share a demo and see if it works. Also looked at hypermerge, it was very tied to node, won't work in the browser. Found yjs, put this in the new hypercore stuff. Got shared types that can be shared on any device.
- Ed: Thinking about annotations being niche. I think it's mainstream but we don't know it. I use Google Docs and commenting on text, the standards we're talking about there. Blog and youtube comments could be annotations. The motivations, there could be stuff like bookmarking, classifying. Recently I wanted to edit video using annotations. It's actually really mainstream, by adding this ability to annotate in a decentralized way is super powerful.
- Jan: Having all the stuff in one place is beneficial. Notebooks you can carry around but they get filled up, if I had all my annotations I could take them around. Maybe annotations are like network effects that platforms want to use to make platforms popular. On youtube they could harvest them and use for machine learning. Companies might be gate keeping and not using the standards for that reason. There's lots of interesting stuff on annotations, gather info and add notes in margins. There's a discussion on the hypermerge repo about support for browsers, mostly a technical issue, there are deps that it's using that don't work in browsers. Once you open up your p2p network to the web, there are lots of clients connecting from browsers that are volatile. They connect, then they disconnect. Client-server architecture, works for servers in data centers, connecting with a small netbook and want to share some arbitrary hypercore data, my connection is bad, small resources. Suddenly if there's hundreds of nodes connecting, because there's people connecting as clients rather than local-first apps. It's a sort of architectural flaw. Posted as a discussion, you need some sort of support in infrastructure to handle this. If I shared my notebook to another gateway, and I got hundreds of peers, it'd take a lot of resources. I think there's an underestimated issue on p2p networks. When looking at browser support we should look at sustaining ourselves. For instance like Beaker, it allows you to seed while you browse, not just when you visit. This kind of difference could be a usability concern and should be on people's minds. Gateways could mitigate this traffic from ephemeral clients. Could be independent of clients
- Frando: I think this annotation use case is good for our shared p2p efforts. Browser question is interesting. Both cobox were doing multiwriter. Sonar also using a gateway approach. You either run a companion service to connect from a regular browser. Similar to IPFS companion. Other use case is to have instances kind of like pubs that are available for groups of people. Even a RasPI on a home router, a constant connection could help with fixing performance compared to browser peers that are constantly connecting and disconnecting. I think it's important to get into browsers, but it'd be good to have bridges and companions. Other challenges in there, tried to package Sonar into something usable for people, ran into a few issues. Not an electron app, just http server. Also got some rust parts in it. Coupling that with OTA updates, that whole area we could be sharing approaches. If you have a single binary people can download and run it. If it's simple then it's not a bad thing to do. Makes it easier to move to other languages. Really interested in booklet and been talking about annotations in Sonar. Would be cool to have another talk just about this stuff, potential collaboration. Now that things seem to work, we have a lot of silos, not in the sense of data, or particular configurations that only work with particular apps. Just because they exist in one app they wouldn't be available in others. There's talk about moving our stacks closer together again. Maybe the benefits aren't immediate. I think the question of the HTTP API, lots of projects have their own. That would be something where we could move it a bit closer together. Have some shared interfaces, would make it possible to combine small tools together. Wouldn't have to reinvent the wheel
- Jan: If we bring protocols port to browsers, HTTP will still be there. Linked data standard is useful. Lots of standards that build on HTTP, standards for data like people and places. Interested in Datdot, like the principle abstraction of the hypercore as the container for all sorts of applications. If there's a mirroring service that replicates hypercores, that'd be a good step. I think it'd make sense to reduce the stacks to something that's more similar. Called hyper (the) well, hyper the source and hyper the book. 🙃 Didn't want to abuse hyper, but working with hypertext it was good to use the term too. Preservation peers are useful notions. Local first folks call it cloud peers. There's still a need for infrastructure that provides better uptime. Until we solve the question of how we can get pure p2p networks, we'll need some sort of online service. SSB has pubs, IPFS has pinning, Textile has something. Still tends to be a bit volatile. This is the problem with HTTP, you have URLs to point to something but if a company runs out of money the link will go down. I think there's probably more sustainable approaches.
- Diego: I suggest contacting Yan.
- Nina: Here can we follow this, is it github or twitter?
- Jan: shoot me a message on twitter @falafeljan https://github.com/hyperwell

### Hypercore in browsers
- Works now
- Have to use fork of sodium-native

## Protocol handlers in the web

- https://github.com/ipfs/devgrants/blob/master/targeted-grants/protocol-handler-api-for-browser-extensions.md
    - https://github.com/whatwg/html/pull/5482
    - https://github.com/datprotocol/DEPs/issues/66 ← comments with references needed
    - https://github.com/ssbc/ssb-spec-drafts/issues/4

- Mauve: what we wanna do as a community regarding egalia, adding protocol handlers they need to be registered into IANA. The result could be adding dat:// to regular browsers. Beaker is using a different notation: hyper://.
- cabal is using their own too: cabal://
- SSB discussion: %wVElBZN8K/gN5FJXcOJCtQTwtEJPfA3wFFjg92gfkOg=.sha256

- lidel: 1st milestone is to have a redirect. FF have this registerProtocolHandler thing.
Are you ok with igalia submitting `dat://` or do you want to do this by yourself?
- mauve: can add some discussion on irc. It might be nice to add dat and hyper protocols.
- dietrich: registration to iana is not tech required but reduce the browsers barriers. IANA reg is an initial registration, reserves the scheme. Its not a full registration. Just the scheme.
Breaking the ground adding this it might ease the past to get into the browsers successfully. igalia has done this before. (igalia: it's an experienced consultancy org.).
- substack: TCP and UDP in chromium?
- Dietrich: There's lots of push back. I started libdweb, but there's not a lot of interested. Taking things apart and tacking it piecemeal. One of the core functions of libdweb was registering protocols, this is an attempt to get that bit into existing rendering engines. It's a small step but we can hopefully get more features.
- Frando: How I perceive discussions is that while all apps make use of hypercore-protocol. Apps use different protocol extensions and there isn't one single dat protocol. This is part of why Beaker and Hyperdrive-daemon are considering adopting the `hyper://` handle. Meaning they speak hypercore protocol use their extension, cabal also uses hypercore-protocol, but with multifeed extensions. I think it would be difficult to get them all in browsers. One thing that was discussed is to get dat into the whitelist, but not yet have a spec on how the handle works or what it means. One possibility would be to have the host component is not the key as it's usually interpreted but maybe it's an app handle. Like `dat://hyper/key` or something else. It'd still have a defined meaning, like delegate to an app if you have it. Maybe different for cabal. Cabal doesn't have a notion of files. Getting the handle in now and then taking a time to spec would be good. Is that a strategy that would work out? Register the handle and take some time to spec out how to interpret it?

- Paul(_from the chat_): the “app handler” premise can definitely work if there’s no need for each key to act as its own origin, which should be feasible
- Paul(_from the chat_): so dat://cabal or hyper://cabal, whichever it is, would effectively be applications (perhaps even served via hyperdrive)
- lidel(_from the chat_): kinda related:  Shared stewardship of the "dweb" protocol handler (also unclear spec) => https://github.com/arewedistributedyet/arewedistributedyet/issues/28
- Lidel: We've wanted to have a single namespace for dweb protocols and have /ipfs or /dat or /hyper or something. It's something on the list for registering. It's part of this igalia work, but we don't have a proper spec for this `dweb://` thing. Problem paul mentioned about origins, first thing after a protocol is the authority. Have some ideas to  work around but feels _hacky_. If you have ideas, they could be reused there. I believe we will as for the dweb handler. Not sure how specific we need to be for the spec. Waiting for feedback from dat and SSB, but will try to also register dweb. If we're okay with dweb, would be okay with Dat. Any type of reference, any type of reference or parsing library would be useful for igalia to make a case for a specific handler.
- Sam: Wanted to weigh in, disagree multiplexing multiple things on one protocol. Scheme is there to specify how to handle it. Cabal etc handle their own protocol. If you change it it messes up how the OS deals with it. For instance you can register if `caba://` launch cabal, if we have `dat://cabal`, the OS can't send it to the right app. Same with mobile URL schemes.
- Lidel: THe multiplexing is why we don't use it in the IPFS, and use ipfs:// and ipns://. That's exactly the person not only at the OS but also browser extensions. If we had it shared, it would have to be a separate thing for acting as a router. Nobody wants two extensions.
- Dietrich: This is the provisional registration, just the scheme, no resolution definition. Fine to delegate down the line. Makes sense to limit to well used for now, and a path to follow.
- mauve: most of this `dat://` and `hyper://` `cabal://` seems to be used a lot in the ecosystem. No one seem to be against igalia doing the registration (reserve scheme).
- Paul: (asked about changing prefix, cost) some internal changes related to change the hyper:// protocol. Url structure remains the same. plus tag at the end.
- Sam: One thing that would be interesting. This + thing might be in violation of existing specs, but that's potentially optional.
- Mauve: Any other questions? Lidel and Dietich
- dietrich: I guess it's OK, we have some similar questions. Great conversation so far. Thumbs up to igalia to continue with the registration. Update issues so we have links to follow. (ipfs?) grant to igalia to work on this. Maybe some updates next week.

## Final

- Diego: We'll have another comm-comm meeting in a different timezone [next week](https://github.com/datproject/comm-comm/issues/145). It was really fun and useful. We had a lot of things to think about it. Final comments or things to mention? We're a bit late, but it was a lot of content today.
- Jan: I'm excited to see so many things happening around Dat. Happy about grants for cabal, for datdot. Sad to hear about cliqz. Really excited to get back into it and working on projects. Thanks for having me.
- Diego: Feel free to follow up with questions on IRC or on the forum. Thanks everybody, hope to see you next week. Martin will be hosting from Japan. Thanks everyone!
